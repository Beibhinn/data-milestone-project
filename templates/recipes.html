{% extends 'base.html' %}
{% block content %}
<div id="filter-container" class="row">
    <span>
        <label>Filters:</label>
        <button class="sort btn btn-floating waves-effect btn-flat " id="filter">
            <i class="material-icons">filter_list</i></button>
    </span>

    <span class="right">
					<label>Sort:</label>
					<button class="sort btn btn-floating waves-effect btn-flat grey-text text-darken-1"
                            onclick="sort('title','asc')">A-Z</button>
					<button class="sort btn btn-floating waves-effect btn-flat grey-text text-darken-1"
                            onclick="sort('title','desc')">Z-A</button>
					<button class="sort btn btn-floating waves-effect btn-flat grey-text text-darken-1"
                            onclick="sort('likes','asc')"><i class="material-icons">arrow_upward</i></button>
					<button class="sort btn btn-floating waves-effect btn-flat grey-text text-darken-1"
                            onclick="sort('likes','desc')"><i class="material-icons">arrow_downward</i></button>
				</span>
    <form id="filter-form" action="{{ url_for('get_recipes') }}" method="GET" style="display: none">
        <div class="input-field col s12 m6 l3">
            <select name="cuisine_name">
                <option value="" disabled selected>Choose your option</option>
                {% for cuisine in cuisines %}
                <option value="{{cuisine.cuisine_name}}">{{cuisine.cuisine_name}}</option>
                {% endfor %}}
            </select>
            <label>Cuisine Select</label>
        </div>
        <div class="input-field col s12 m6 l3">
            <select name="user_name">
                <option value="" disabled selected>Choose your option</option>
                {% for user in users %}
                <option value="{{user.user_name}}">{{user.user_name}}</option>
                {% endfor %}}
            </select>
            <label>User Select</label>
        </div>
        <div class="input-field col s12 m6 l3">
            <select multiple name="tag_name[]">
                <option value="" disabled selected>Choose your option</option>
                {% for tag in tags %}
                <option value="{{tag.tag_name}}">{{tag.tag_name}}</option>
                {% endfor %}}
            </select>
            <label>Tag Multiple Select</label>
        </div>
        <div class="col s12 m6 l3">
            <button class="btn waves-effect waves-light" type="submit" name="action">Filter
                <i class="material-icons right">filter_list</i>
            </button>
            <button class="btn waves-effect waves-light" type="reset" name="action">Clear
                <i class="material-icons right">clear</i>
            </button>
        </div>
    </form>
</div>
<div class="row">
    <span class="right">
        <p class="grey-text"> Results: {{ recipes|length }}</p>
    </span>
</div>
<div class="row">
    {% if recipes|length == 0 %}
    <div class="toast" style="position: initial">No recipes found.<i class="close material-icons">close</i></div>
    {% else %}
    {% for recipe in recipes %}
    <div class="col s12 m4">
        <div class="card sticky-action">
            <div class="card-image waves-effect waves-block waves-light">
                <img class="activator" src="{{recipe.photo_src}}">
            </div>
            <div class="card-content">
                    <span class="card-title activator grey-text text-darken-4">{{recipe.title}}<i
                            class="material-icons right">more_vert</i></span>
                <p>By <a href="{{url_for('user_recipes', user_name=recipe.user_name)}}">{{recipe.user_name}}</a></p>
            </div>
            <div class="card-action">
                <a href="{{url_for('view_recipe', recipe_id=recipe._id)}}" class="link">Full recipe</a>
                <div class="right">{{ recipe.likes|length }} likes</div>
            </div>
            <div class="card-reveal">
                    <span class="card-title grey-text text-darken-4">{{recipe.title}}<i
                            class="material-icons right">close</i></span>
                {% for item in recipe.ingredients %}
                <p>{{ item }}</p>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endfor %}
    {% endif %}
</div>
<div class="fixed-action-btn">
    <a href="{{url_for('add_recipe')}}" class="btn-floating btn-large waves-effect waves-light add"><i
            class="material-icons">add</i></a>
</div>
{% endblock %}
{% block scripts %}
<script>
    $("#filter").click(function() {
        $("#filter-form").slideToggle()
    });


    function sort(by, order) {
        if ('URLSearchParams' in window) { // https://stackoverflow.com/a/41542008
            let searchParams = new URLSearchParams(window.location.search);
            searchParams.set('sort', by);
            searchParams.set('order', order);
            window.location.search = searchParams.toString();
        }
    }
</script>
{% endblock %}








